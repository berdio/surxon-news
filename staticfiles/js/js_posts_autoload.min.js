var tdbAutoload={};!function(t,o,a){var d=t(document),e=t(o);t("body"),tdbAutoload={original_post_id:null,is_ajax_running:!1,init:function(){var n=t("#tdb-autoload-article");if(0!==n.length){var i=n.data("autoload"),l=n.data("autoload-type"),r=n.data("autoload-count"),u=n.data("autoload-org-post-id"),s=u,c=0;tdbAutoload.original_post_id=u,tdbAutoload.log("%c tdbAutoload(inf) art. settings","background: #ffaa00; color: #ffffff; padding:3px 6px"),tdbAutoload.log("tdbAutoload status: "+i),tdbAutoload.log("tdbAutoload type: "+l),tdbAutoload.log("tdbAutoload original post id: "+u),tdbAutoload.log("tdbAutoload count: "+parseInt(r,10)),tdbAutoload.log("tdbAutoload scroll percent: "+o.tdb_globals.autoloadScrollPercent),l=a.debounce((function(){if(tdbAutoload.log("ajax autoload > scroll"),!0!==tdbAutoload.is_ajax_running){var i=100*e.scrollTop()/(d.height()-e.height()),l=o.tdb_globals.autoloadScrollPercent;(!r||c<parseInt(r,10))&&i>=l&&u===s&&(tdbAutoload._ajaxLoadingStart(n),tdbAutoload.is_ajax_running=!0,t.ajax({timeout:5e4,type:"POST",url:tdbAutoload._getRestEndPoint("td-cloud-library/ajax_autoload","uid="+tdbAutoload._getUniqueID()),beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",o.tdb_globals.wpRestNonce),u=null},data:{currentPostId:s,originalPostId:tdbAutoload.original_post_id},success:function(d,e,i){null!==d&&void 0===d.error&&(void 0!==d.noPosts?tdbAutoload._ajaxLoadingEnd(n):(c++,e=t(d.article),t(e).appendTo(n.find(".tdc-content-wrap")),s=u=d.id,e.filter("#tdb-infinte-post-"+s+"-iframe").load((function(){var d=t(this);tdbAutoload.is_ajax_running=!1,tdbAutoload._ajaxLoadingEnd(n),d.css("opacity",1),setTimeout((function(){var t=d.contents().find("html").outerHeight(!0)+2;tdbAutoload.log("initial iframe load height set to: "+t),d.height(t)}),50),d.contents().find("html").attr("id",d.attr("id"));var e=o.MutationObserver||o.WebKitMutationObserver||o.MozMutationObserver,i=document.querySelector("#"+d.attr("id")),l=(i.contentDocument||i.contentWindow.document).getElementsByTagName("html"),r=a.debounce((function(){var t=l[0].offsetHeight;tdbAutoload.log("setHeight: height set to: "+t),d.height(t)}),10);new e((function(t){t.forEach((function(t){tdbAutoload.log("mutation occurred!"),tdbAutoload.log(t),r()}))})).observe(l[0],{childList:!0,subtree:!0})}))))},error:function(t,o,a){}}))}}),100);var g=a.debounce((function(){tdbAutoload.log("ajax_autoload > resize"),t(".tdb-autoload-wrap").find(".tdb-infinte-post-iframe").each((function(){var o=t(this);o.height(o.contents().find("html").outerHeight())}))}),100),f=a.debounce((function(){tdbAutoload.log("ajax autoload > scroll location change"),tdbAutoload._locationChange()}),10);"on"===i&&(e.scroll(l),e.scroll(f),e.resize(g),e.resize((function(){})),e.scroll((function(){})))}},_fixSmartSidebar:function(){var o=e.scrollTop(),a=o+e.height();t(".tdb-autoload-wrap").find("iframe").each((function(){var d=t(this),e=d.offset().top-t("#wpadminbar").outerHeight(),n=d.outerHeight(!0),i=d.attr("id");d.data("post-title"),e<o&&e+n>a&&document.getElementById(i).contentWindow.tdSmartSidebar.td_events_scroll(o-e)}))},_locationChange:function(){var a=e.scrollTop(),d=a+e.height(),n=[];if(t(".tdb-autoload-wrap").find("article, iframe").each((function(){var o=t(this),e=o.offset().top-(t(".td-header-menu-wrap.td-affix").outerHeight()+t("#wpadminbar").outerHeight()),i=o.outerHeight(!0),l=o.data("post-url"),r=o.data("post-edit-url");o=o.data("post-title"),i=e+i,(e<a&&i>d||e>a&&e<d||i>a&&i<d)&&n.push({top:e,bottom:i,post_url:l,post_edit_url:r,post_title:o})})),0===n.length)var i=o.location.href,l=o.tdb_globals.origPostEditUrl,r=document.title;else 1===n.length?(i=(r=n.pop()).post_url,l=r.post_edit_url,r=r.post_title):(i=n[0].post_url,l=n[0].post_edit_url,r=n[0].post_title);tdbAutoload._updatePostURL(i,l,r)},_updatePostURL:function(a,d,e){o.location.href!==a&&""!==a&&(o.history.replaceState(null,null,a),document.title=e,o.tdb_globals.isAdminBarShowing&&t("#wp-admin-bar-edit").find("a").attr("href",d))},_ajaxLoadingStart:function(o){t(".td-loader-gif").remove(),o.find(".tdc-content-wrap").append('<div class="td-loader-gif td-loader-animation-start tdb-loader-autoload"></div>'),tdLoadingBox.init(tds_theme_color_site_wide),setTimeout((function(){t(".td-loader-gif").removeClass("td-loader-animation-start").addClass("td-loader-animation-mid")}),50)},_ajaxLoadingEnd:function(t){t.find(".td-loader-gif").removeClass("td-loader-animation-mid").addClass("td-loader-animation-end"),setTimeout((function(){t.find(".td-loader-gif").remove(),tdLoadingBox.stop()}),400)},_getRestEndPoint:function(t,d){return a.isEmpty(o.tdb_globals.permalinkStructure)?o.tdb_globals.wpRestUrl+t+"&"+d:o.tdb_globals.wpRestUrl+t+"?"+d},_getUniqueID:function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},log:function(t,o){}},d.ready((function(){tdbAutoload.init()}))}(jQuery,this,_);